"use strict";(self["webpackChunklight_container"]=self["webpackChunklight_container"]||[]).push([[788],{788:function(s,t,o){o.r(t),o.d(t,{default:function(){return u}});var e=function(){var s=this,t=s.$createElement,o=s._self._c||t;return o("div",{staticClass:"reading-container"},[o("div",{staticClass:"reading-context"},[o("h2",[s._v(s._s(s.book_title))]),s._l(s.rounds,(function(t,e){return o("span",{key:"context-"+e,class:["reading-char",e-s.cursor==1?"near":"",e==s.cursor&&"\n"!=t.value?"current":"",t.pressed?"pressed":"",t.missed?"missing":"",t.correct?"correct":"",t.wrong?"wrong":"","\n"==t.value?"enter":""]},[s._v(" "+s._s(t.value)+" ")])}))],2),o("div",{staticClass:"reading-opts"},[o("div",{staticClass:"reading-opts__btn",on:{click:s.start}},[s._v("开始")]),o("div",{staticClass:"reading-opts__btn",on:{click:s.pause}},[s._v("暂停")]),o("div",{staticClass:"reading-opts__btn",on:{click:s.next}},[s._v("继续")]),s.page>0?o("div",{staticClass:"reading-opts__btn",on:{click:function(t){return s.turn(-1)}}},[s._v("上一页")]):s._e(),s.page<s.book.length-1?o("div",{staticClass:"reading-opts__btn",on:{click:function(t){return s.turn(1)}}},[s._v("下一页")]):s._e(),o("div",{staticClass:"reading-opts__btn"},[s._v("命中："+s._s(s.board.hits))]),o("div",{staticClass:"reading-opts__btn"},[s._v("失误："+s._s(s.board.errors))]),o("div",{staticClass:"reading-opts__btn"},[s._v("遗漏："+s._s(s.board.misses))]),o("div",{staticClass:"reading-opts__btn"},[s._v("连击："+s._s(s.combo))]),o("div",{staticClass:"reading-opts__btn"},[s._v("最长连击："+s._s(s.max_combo))]),o("div",{staticClass:"reading-opts__btn"},[s._v("连击次数："+s._s(s.board.combos))])])])},r=[],i=o(669),n=o.n(i),c=o(71),a={data(){return{clock:null,book_title:"",book:[],context:"",rounds:[],cursor:-1,page:0,commas:["，","。","：","”","“","；","《","》","？","、","！"],playing:!1,combo:0,max_combo:0,combos:[]}},computed:{board(){return{hits:this.rounds.filter((s=>"\n"!=s.value&&s.correct)).length,errors:this.rounds.filter((s=>"\n"!=s.value&&s.wrong)).length,misses:this.rounds.filter((s=>"\n"!=s.value&&s.missed)).length,combos:this.combos.length}}},methods:{separate(s){const t=5;for(let o=0;o<s.length;o+=t)this.book.push(s.slice(o,o+t))},view(){const s=this;n().get(`${c.H}/reading/book?addr=${this.$route.query.addr}`).then((t=>{s.book_title=t.data.title,s.separate(t.data.content),s.context=s.book[s.page].join("\n"),s.init()})).catch((s=>s))},pause(){this.playing=!1,clearInterval(this.clock)},check(s){return this.commas.indexOf(s)>=0?"comma":"word"},init(){for(let s=0;s<this.context.length;s++)this.rounds.push({value:this.context.charAt(s),pressed:!1,missed:!1,correct:!1,wrong:!1})},clear(){this.combo>0&&(this.combos.push(this.combo),this.combo>this.max_combo&&(this.max_combo=this.combo),this.combo=0)},next(){const s=this;this.playing=!0,this.clock=setInterval((()=>{s.cursor<s.rounds.length&&!s.rounds[s.cursor].pressed&&(s.rounds[s.cursor].missed=!0,s.clear()),s.cursor<s.rounds.length?s.cursor++:(s.clear(),clearInterval(s.clock))}),350)},press(s){if(this.cursor>=0){const t=this.rounds[this.cursor].value;this.rounds[this.cursor].pressed||(this.check(t)==s?(this.rounds[this.cursor].correct=!0,this.combo++):(this.rounds[this.cursor].wrong=!0,this.clear()),this.rounds[this.cursor].pressed=!0)}},start(){this.cursor=0,this.playing=!0,this.next()},turn(s){this.page=this.page+s,this.context=this.book[this.page].join("\n"),this.rounds=[],this.init(),this.cursor=-1,clearInterval(this.clock)}},mounted(){this.view();const s=this;window.addEventListener("keydown",(t=>{console.log(t.code),"KeyZ"==t.code?s.press("word"):"KeyX"==t.code?s.press("comma"):"Space"==t.code&&(s.playing?s.pause():-1==this.cursor?s.start():s.next())}))}},d=a,l=o(1),h=(0,l.Z)(d,e,r,!1,null,"5a4a2e40",null),u=h.exports}}]);
//# sourceMappingURL=788.eb244846.js.map